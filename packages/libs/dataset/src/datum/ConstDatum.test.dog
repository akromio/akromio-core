use (
  alias://expected
  ConstDatum, DatumError
)

suite(__filename, proc()
  suite("post", proc()
    test("when merge is map, this must be merged to the value", proc()
      # (1) act
      const out = ConstDatum(name = "c", merge = {y = 2}, value = {x = 1, z = 3})

      # (2) assessment
      expected(out.getValue()).equalTo(x = 1, y = 2, z = 3)
    end)

    test("when merge is list, this must be concatenated to the value", proc()
      # (1) act
      const out = ConstDatum(name = "c", merge = [3, 4], value = [1, 2])

      # (2) assessment
      expected(out.getValue([1, 2, 3, 4]))
    end)

    test("when merge is list and value doesn't, error must be raised", proc()
      # (1) act
      const out = peval(ConstDatum(name = "c", merge = [3, 4], value = {}))

      # (2) assessment
      expected(out).it(0).equalTo(false).it(1).equalTo(TypeError("Datum 'c' expected to be list for merging new items."))
    end)
  end)

  suite("setValue()", proc()
    test("when setValue called, error must be raised", proc()
      # (1) act
      const (
        datum = ConstDatum(name = "c", value = 123)
        out = peval(datum.setValue(321))
      )

      # (2) assessment
      expected(out)\
        .it(0).equalTo(false)\
        .it(1).toBe(DatumError).like("Datum 'c' is not updatable.")
    end)
  end)
end)
